{% extends 'merchantsideapp/base_sidebar.html' %}
{% load static %}
{% block page_title %}Foodie Â· ç®¡ç†é¤é»{% endblock %}

{% block content %}
<!-- Main Card -->
<div class="card mb-6">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
        <div>
            <h1 class="text-xl font-bold text-gray-900">ç®¡ç†é¤é»</h1>
            <p class="text-sm text-gray-500">ç¶­è­·ç¾æœ‰é¤é»è³‡è¨Šï¼Œå¯ç·¨è¼¯ã€åˆªé™¤ã€èª¿æ•´æˆ–æ§åˆ¶é¤é»ä¸Šæ¶ï¼ä¸‹æ¶ç‹€æ…‹ã€‚</p>
        </div>
        <button class="btn-primary px-4" type="button" id="btn-go-add">ï¼‹ æ–°å¢é¤é»</button>
    </div>

    <!-- Filters -->
    <form method="get" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-6 p-4 bg-gray-50 rounded-lg"
        id="manage-filter-form">
        <div class="form-group lg:col-span-2">
            <label class="form-label text-xs" for="keyword-input">é—œéµå­—æœå°‹</label>
            <input class="form-input" id="keyword-input" name="keyword" type="text" placeholder="è¼¸å…¥é¤é»åç¨±æˆ–æ•˜è¿°ç‰‡èª"
                value="{{ keyword }}">
        </div>
        <div class="form-group">
            <label class="form-label text-xs" for="category-select">é¡åˆ¥</label>
            <select class="form-select" id="category-select" name="category">
                <option value="">å…¨éƒ¨é¡åˆ¥</option>
                {% for category in categories %}
                <option value="{{ category }}" {% if category == selected_category %}selected{% endif %}>{{ category }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label class="form-label text-xs" for="status-select">ç‹€æ…‹</label>
            <select class="form-select" id="status-select" name="status">
                <option value="">å…¨éƒ¨ç‹€æ…‹</option>
                <option value="available" {% if selected_status == 'available' %}selected{% endif %}>ä¸Šæ¶ä¸­</option>
                <option value="unavailable" {% if selected_status == 'unavailable' %}selected{% endif %}>å·²ä¸‹æ¶</option>
            </select>
        </div>
        <div class="flex items-end gap-2">
            <button type="submit" class="btn-secondary flex-1 text-sm py-2">å¥—ç”¨ç¯©é¸</button>
            <a class="btn-secondary text-sm py-2 px-3 border-gray-300 text-gray-600"
                href="{% url 'merchantsideapp:manage_meals' %}">æ¸…é™¤</a>
        </div>
    </form>

    <!-- Meal List -->
    <div class="overflow-x-auto">
        <table class="w-full text-sm">
            <thead class="bg-gray-50 text-gray-600 uppercase text-xs">
                <tr>
                    <th class="px-4 py-3 text-left font-medium">é¤é»åç¨±</th>
                    <th class="px-4 py-3 text-left font-medium">é¡åˆ¥</th>
                    <th class="px-4 py-3 text-left font-medium">åƒ¹æ ¼</th>
                    <th class="px-4 py-3 text-left font-medium">ç‹€æ…‹</th>
                    <th class="px-4 py-3 text-right font-medium">æ“ä½œ</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {% if meals %}
                {% for meal in meals %}
                <tr class="hover:bg-gray-50" data-meal-id="{{ meal.id }}">
                    <td class="px-4 py-4">
                        <a class="font-medium text-gray-900 hover:text-primary-600"
                            href="{% url 'merchantsideapp:meal_detail' meal.id %}">{{ meal.name }}</a>
                        <p class="text-xs text-gray-400 mt-0.5">
                            {{ meal.description|default:"å°šæœªæä¾›é¤é»æè¿°"|truncatechars:40 }}</p>
                        <div class="flex gap-1 mt-1">
                            {% if meal.is_vegetarian %}<span class="pill-success text-xs">ç´ é£Ÿ</span>{% endif %}
                            {% if meal.is_spicy %}<span class="pill-warning text-xs">è¾›è¾£</span>{% endif %}
                            {% if meal.nutrition_count %}<span class="pill-gray text-xs">ç‡Ÿé¤Š 
                                {{ meal.nutrition_count }}é …</span>{% endif %}
                        </div>
                    </td>
                    <td class="px-4 py-4">
                        <span class="pill-info text-xs">{{ meal.category|default:"æœªåˆ†é¡" }}</span>
                    </td>
                    <td class="px-4 py-4">
                        {% if meal.price %}
                        <span class="font-semibold text-gray-900">$ {{ meal.price|floatformat:0 }}</span>
                        {% else %}
                        <span class="text-gray-400">â€”</span>
                        {% endif %}
                    </td>
                    <td class="px-4 py-4">
                        <span class="pill-{{ meal.is_available|yesno:'success,gray' }} text-xs">
                            {{ meal.is_available|yesno:"ä¸Šæ¶ä¸­,å·²ä¸‹æ¶" }}</span>
                        <p class="text-xs text-gray-400 mt-0.5">æ›´æ–°æ–¼ {{ meal.updated_at|date:"n/d" }}</p>
                    </td>
                    <td class="px-4 py-4">
                        <div class="flex items-center justify-end gap-2">
                            <a class="text-gray-500 hover:text-primary-600"
                                href="{% url 'merchantsideapp:meal_detail' meal.id %}" title="è©³æƒ…">ğŸ‘</a>
                            <a class="text-gray-500 hover:text-primary-600"
                                href="{% url 'merchantsideapp:edit_meal' meal.id %}" title="ç·¨è¼¯">âœ</a>
                            <form method="post" action="{% url 'merchantsideapp:delete_meal' meal.id %}"
                                class="inline status-form" data-meal-name="{{ meal.name }}"
                                data-action-label="{% if meal.is_available %}ä¸‹æ¶{% else %}é‡æ–°ä¸Šæ¶{% endif %}">
                                {% csrf_token %}
                                <input type="hidden" name="action"
                                    value="{% if meal.is_available %}deactivate{% else %}activate{% endif %}">
                                {% if meal.is_available %}
                                <button class="text-gray-500 hover:text-orange-600" type="submit" title="ä¸‹æ¶">â‡£</button>
                                {% else %}
                                <button class="text-gray-500 hover:text-green-600" type="submit" title="é‡æ–°ä¸Šæ¶">â‡¡</button>
                                {% endif %}
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                        ç›®å‰å°šæœªæ–°å¢ä»»ä½•é¤é»ï¼Œé»æ“Šå³ä¸Šè§’ã€Œæ–°å¢é¤é»ã€å³å¯å»ºç«‹ç¬¬ä¸€é“é¤é»ã€‚
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Archived Section -->
<div class="card">
    <div class="mb-4">
        <h2 class="text-lg font-semibold text-gray-900">å·²ä¸‹æ¶é¤é»</h2>
        <p class="text-sm text-gray-500">æœ€å¤šé¡¯ç¤ºæœ€è¿‘ 5 ç­†ä¸‹æ¶ç´€éŒ„ï¼Œå¯é€éä¸Šæ–¹ã€Œç‹€æ…‹ã€ç¯©é¸æŸ¥çœ‹æ›´å¤šã€‚</p>
    </div>
    {% if archived_preview %}
    <div class="space-y-3">
        {% for meal in archived_preview %}
        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <div>
                <div class="font-medium text-gray-900">{{ meal.name }}</div>
                <div class="text-xs text-gray-500">{{ meal.updated_at|date:"n/d H:i" }} Â· {{ meal.category|default:"æœªåˆ†é¡"
                    }}</div>
            </div>
            <div class="flex items-center gap-3">
                <span class="pill-gray text-xs">å·²ä¸‹æ¶</span>
                <form method="post" action="{% url 'merchantsideapp:delete_meal' meal.id %}" class="inline status-form"
                    data-meal-name="{{ meal.name }}" data-action-label="é‡æ–°ä¸Šæ¶">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="activate">
                    <button class="btn-secondary text-xs px-3 py-1" type="submit">â‡¡ é‡æ–°ä¸Šæ¶</button>
                </form>
                <a class="btn-secondary text-xs px-3 py-1" href="{% url 'merchantsideapp:edit_meal' meal.id %}">âœ ç·¨è¼¯</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="text-center text-gray-500 py-6">ç›®å‰æ²’æœ‰ä¸‹æ¶ç´€éŒ„ï¼Œé»é¸ä¸Šæ–¹ã€Œä¸‹æ¶ã€å³å¯åœ¨æ­¤å¿«é€ŸæŸ¥çœ‹ã€‚</p>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'merchantsideapp/js/merchant_manage_meals.js' %}"></script>
{% endblock %}