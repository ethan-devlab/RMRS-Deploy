{% load static %}
<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foodie Â· ç®¡ç†é¤é»</title>
    <link rel="stylesheet" href="{% static 'merchantsideapp/css/merchant_manage_meal.css' %}">
</head>

<body>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="toggle-btn" id="toggleBtn">â˜°</button>
            <h2 class="logo"><span class="logo-text">Foodie å•†å®¶ç«¯</span></h2>
        </div>
        <ul>
            <li id="menu-dashboard">
                <span class="icon">ğŸ </span>
                <span class="item-text">ä¸»é ç¸½è¦½</span>
            </li>
            <li id="menu-add">
                <span class="icon">â•</span>
                <span class="item-text">æ–°å¢é¤é»</span>
            </li>
            <li class="active" id="menu-manage">
                <span class="icon">ğŸ“‹</span>
                <span class="item-text">ç®¡ç†é¤é»</span>
            </li>
            <li id="menu-settings">
                <span class="icon">âš™ï¸</span>
                <span class="item-text">è¨­å®š</span>
            </li>
            <li class="logout" id="menu-logout">
                <span class="icon">ğŸšª</span>
                <span class="item-text">ç™»å‡º</span>
            </li>
        </ul>
    </div>

    <div class="main">
        <div class="main-inner">
            {% if messages %}
            <ul class="messages">
                {% for message in messages %}
                <li class="{{ message.tags }}">{{ message }}</li>
                {% endfor %}
            </ul>
            {% endif %}
            <div class="manage-card">
                <div class="manage-header">
                    <div>
                        <h1 class="manage-title">ç®¡ç†é¤é»</h1>
                        <p class="manage-sub">ç¶­è­·ç¾æœ‰é¤é»è³‡è¨Šï¼Œå¯ç·¨è¼¯ã€åˆªé™¤ã€èª¿æ•´æˆ–æ§åˆ¶é¤é»ä¸Šæ¶ï¼ä¸‹æ¶ç‹€æ…‹ã€‚</p>
                    </div>
                    <button class="add-btn primary" type="button" id="btn-go-add">ï¼‹ æ–°å¢é¤é»</button>
                </div>

                <form method="get" class="manage-filters" id="manage-filter-form">
                    <div class="filter-group">
                        <label for="keyword-input">é—œéµå­—æœå°‹</label>
                        <input class="field-input" id="keyword-input" name="keyword" type="text"
                            placeholder="è¼¸å…¥é¤é»åç¨±æˆ–æ•˜è¿°ç‰‡èª" value="{{ keyword }}">
                    </div>
                    <div class="filter-group">
                        <label for="category-select">é¡åˆ¥</label>
                        <select class="field-input" id="category-select" name="category">
                            <option value="">å…¨éƒ¨é¡åˆ¥</option>
                            {% for category in categories %}
                            <option value="{{ category }}" {% if category == selected_category %}selected{% endif %}>{{
                                category }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="status-select">ç‹€æ…‹</label>
                        <select class="field-input" id="status-select" name="status">
                            <option value="">å…¨éƒ¨ç‹€æ…‹</option>
                            <option value="available" {% if selected_status == 'available' %}selected{% endif %}>ä¸Šæ¶ä¸­
                            </option>
                            <option value="unavailable" {% if selected_status == 'unavailable' %}selected{% endif %}>å·²ä¸‹æ¶
                            </option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button type="submit" class="add-btn secondary">å¥—ç”¨ç¯©é¸</button>
                        <a class="add-btn ghost" href="{% url 'merchantsideapp:manage_meals' %}">æ¸…é™¤æ¢ä»¶</a>
                    </div>
                </form>

                <div class="menu-list">
                    <div class="menu-row menu-row-header">
                        <div class="col-name">é¤é»åç¨±</div>
                        <div class="col-cat">é¡åˆ¥</div>
                        <div class="col-price">åƒ¹æ ¼</div>
                        <div class="col-status">ç‹€æ…‹</div>
                        <div class="col-actions">æ“ä½œ</div>
                    </div>

                    {% if meals %}
                    {% for meal in meals %}
                    <div class="menu-row" data-meal-id="{{ meal.id }}">
                        <div class="col-name">
                            <a class="name-line" href="{% url 'merchantsideapp:meal_detail' meal.id %}">
                                {{ meal.name }}
                            </a>
                            <span class="menu-sub">{{ meal.description|default:"å°šæœªæä¾›é¤é»æè¿°"|truncatechars:60 }}</span>
                            <div class="menu-tags">
                                {% if meal.is_vegetarian %}<span class="menu-tag veg">Vegetarian</span>{% endif %}
                                {% if meal.is_spicy %}<span class="menu-tag spicy">Spicy</span>{% endif %}
                                {% if meal.nutrition_count %}<span class="menu-tag meta">ç‡Ÿé¤Š {{ meal.nutrition_count }}
                                    é …</span>{% endif %}
                            </div>
                        </div>
                        <div class="col-cat">
                            <span class="menu-chip">{{ meal.category|default:"æœªåˆ†é¡" }}</span>
                        </div>
                        <div class="col-price">
                            {% if meal.price %}
                            <span class="price-value">$ {{ meal.price|floatformat:0 }}</span>
                            {% else %}
                            <span class="price-empty">â€”</span>
                            {% endif %}
                        </div>
                        <div class="col-status">
                            <span class="status-pill {% if meal.is_available %}on{% else %}off{% endif %}">
                                {{ meal.is_available|yesno:"ä¸Šæ¶ä¸­,å·²ä¸‹æ¶" }}
                            </span>
                            <span class="status-meta">æ›´æ–°æ–¼ {{ meal.updated_at|date:"n/d" }}</span>
                        </div>
                        <div class="col-actions">
                            <a class="row-btn action-view" href="{% url 'merchantsideapp:meal_detail' meal.id %}">
                                <span class="btn-icon" aria-hidden="true">ğŸ‘</span>
                                <span>è©³æƒ…</span>
                            </a>
                            <a class="row-btn action-edit" href="{% url 'merchantsideapp:edit_meal' meal.id %}">
                                <span class="btn-icon" aria-hidden="true">âœ</span>
                                <span>ç·¨è¼¯</span>
                            </a>
                            <form method="post" action="{% url 'merchantsideapp:delete_meal' meal.id %}"
                                class="delete-form" data-meal-name="{{ meal.name }}">
                                {% csrf_token %}
                                <button class="row-btn action-down" type="submit">
                                    <span class="btn-icon" aria-hidden="true">â‡£</span>
                                    <span>ä¸‹æ¶</span>
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="menu-empty">
                        <p>ç›®å‰å°šæœªæ–°å¢ä»»ä½•é¤é»ï¼Œé»æ“Šå³ä¸Šè§’ã€Œæ–°å¢é¤é»ã€å³å¯å»ºç«‹ç¬¬ä¸€é“é¤é»ã€‚</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="archived-card">
                <div class="archived-header">
                    <div>
                        <h2>å·²ä¸‹æ¶é¤é»</h2>
                        <p>æœ€å¤šé¡¯ç¤ºæœ€è¿‘ 5 ç­†ä¸‹æ¶ç´€éŒ„ï¼Œå¯é€éä¸Šæ–¹ã€Œç‹€æ…‹ã€ç¯©é¸æŸ¥çœ‹æ›´å¤šã€‚</p>
                    </div>
                </div>
                {% if archived_preview %}
                <div class="archived-list">
                    {% for meal in archived_preview %}
                    <div class="archived-row">
                        <div>
                            <div class="archived-name">{{ meal.name }}</div>
                            <div class="archived-meta">
                                {{ meal.updated_at|date:"n/d H:i" }} Â· {{ meal.category|default:"æœªåˆ†é¡" }}
                            </div>
                        </div>
                        <div class="archived-actions">
                            <span class="archived-status">å·²ä¸‹æ¶</span>
                            <a class="row-btn action-edit" href="{% url 'merchantsideapp:edit_meal' meal.id %}">
                                <span class="btn-icon" aria-hidden="true">âœ</span>
                                <span>ç·¨è¼¯</span>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="archived-empty">ç›®å‰æ²’æœ‰ä¸‹æ¶ç´€éŒ„ï¼Œé»é¸ä¸Šæ–¹ã€Œä¸‹æ¶ã€å³å¯åœ¨æ­¤å¿«é€ŸæŸ¥çœ‹ã€‚</div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        window.merchantRoutes = {
            dashboard: "{% url 'merchantsideapp:dashboard' %}",
            addMeal: "{% url 'merchantsideapp:add_meal' %}",
            manageMeals: "{% url 'merchantsideapp:manage_meals' %}",
            settings: "{% url 'merchantsideapp:settings' %}",
            login: "{% url 'merchantsideapp:login' %}",
            logout: "{% url 'merchantsideapp:logout' %}"
        };
    </script>
    <script src="{% static 'merchantsideapp/js/merchant_homepage.js' %}"></script>
    <script src="{% static 'merchantsideapp/js/merchant_manage_meals.js' %}"></script>
</body>

</html>