{% load static %}
<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foodie Â· å•†å®¶ä¸»é </title>
    <link rel="stylesheet" href="{% static 'merchantsideapp/css/merchant_homepage.css' %}">
</head>

<body>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="toggle-btn" id="toggleBtn">â˜°</button>
            <h2 class="logo"><span class="logo-text">Foodie å•†å®¶ç«¯</span></h2>
        </div>
        <ul>
            <li class="active" id="menu-dashboard">
                <span class="icon">ğŸ </span>
                <span class="item-text">ä¸»é ç¸½è¦½</span>
            </li>
            <li id="menu-add">
                <span class="icon">â•</span>
                <span class="item-text">æ–°å¢é¤é»</span>
            </li>
            <li id="menu-manage">
                <span class="icon">ğŸ“‹</span>
                <span class="item-text">ç®¡ç†é¤é»</span>
            </li>
            <li id="menu-settings">
                <span class="icon">âš™ï¸</span>
                <span class="item-text">è¨­å®š</span>
            </li>
            <li class="logout" id="menu-logout">
                <span class="icon">ğŸšª</span>
                <span class="item-text">ç™»å‡º</span>
            </li>
        </ul>
    </div>

    <div class="main">
        <div class="main-inner">
            {% if messages %}
            <ul class="messages">
                {% for message in messages %}
                <li class="{{ message.tags }}">{{ message }}</li>
                {% endfor %}
            </ul>
            {% endif %}
            <div class="welcome-box merchant-header">
                <div class="merchant-left">
                    <h1>æ­¡è¿å›ä¾†ï¼Œ{{ merchant_display_name }}ï¼</h1>
                    <p>ä½ å¯ä»¥åœ¨é€™è£¡æ–°å¢é¤é»ã€ç·¨è¼¯æˆ–ä¸‹æ¶æ—¢æœ‰é¤é»ï¼Œæ–¹ä¾¿ç®¡ç†èœå–®ã€‚</p>
                </div>
                <div class="merchant-right">
                    <div class="stat-pill">ç›®å‰ç‹€æ…‹ï¼š
                        <span class="{% if restaurant and restaurant.is_active %}stat-ok{% else %}stat-off{% endif %}">
                            {% if restaurant and restaurant.is_active %}ç‡Ÿæ¥­{% else %}æ²’æœ‰ç‡Ÿæ¥­{% endif %}
                        </span>
                    </div>
                    {% if restaurant %}
                        <form method="post" action="{% url 'merchantsideapp:restaurant_status' %}" class="status-form">
                            {% csrf_token %}
                            <label class="status-label" for="status-select">å¿«é€Ÿèª¿æ•´</label>
                            <div class="status-control">
                                <select id="status-select" name="status" class="status-select">
                                    <option value="open" {% if status_slug == 'open' %}selected{% endif %}>ç‡Ÿæ¥­</option>
                                    <option value="closed" {% if status_slug == 'closed' %}selected{% endif %}>æ²’æœ‰ç‡Ÿæ¥­</option>
                                </select>
                                <button type="submit" class="status-apply">æ›´æ–°</button>
                            </div>
                        </form>
                    {% endif %}
                    <div class="stat-small">
                        <span>ä»Šå¤©å·²å»ºç«‹é¤é»ï¼š{{ today_count }} ç­†</span>
                        <span>æœ€å¾Œæ›´æ–°æ™‚é–“ï¼š
                            {% if last_updated_meal %}
                            {{ last_updated_meal.updated_at|date:"n/d H:i" }}
                            {% else %}
                            --
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>

            <div class="section-title">å¿«é€Ÿæ“ä½œ</div>
            <div class="card-row quick-actions">
                <div class="card action-card">
                    <div class="action-icon">â•</div>
                    <div class="action-title">æ–°å¢é¤é»</div>
                    <div class="action-desc">å»ºç«‹æ–°çš„é¤é»å“é …ï¼ŒåŒ…å«åç¨±ã€åˆ†é¡ã€åƒ¹æ ¼ã€æè¿°èˆ‡ä¸Šå‚³ç…§ç‰‡ã€‚</div>
                    <button class="action-btn" id="btn-go-add">å‰å¾€æ–°å¢é¤é»</button>
                </div>
                <div class="card action-card">
                    <div class="action-icon">ğŸ“‹</div>
                    <div class="action-title">ç®¡ç†é¤é»</div>
                    <div class="action-desc">ç·¨è¼¯å·²å»ºç«‹çš„é¤é»ï¼Œå¯èª¿æ•´åƒ¹æ ¼ã€ä¿®æ”¹å…§å®¹ï¼Œæˆ–å°‡é¤é»ä¸Šæ¶ / ä¸‹æ¶ã€‚</div>
                    <button class="action-btn secondary" id="btn-go-manage">å‰å¾€ç®¡ç†é¤é»</button>
                </div>
                {% if restaurant %}
                <div class="card action-card">
                    <div class="action-icon">ğŸ¨</div>
                    <div class="action-title">é¤å»³è³‡è¨Š</div>
                    <div class="action-desc">å¿«é€ŸæŸ¥çœ‹é¤å»³è©³ç´°è³‡è¨Šã€ä½ç½®èˆ‡ç›®å‰èœå–®ï¼Œä»¥ä¾¿åˆ†äº«çµ¦æ¶ˆè²»è€…ã€‚</div>
                    <button class="action-btn ghost" id="btn-go-restaurant">æŸ¥çœ‹é¤å»³é é¢</button>
                </div>
                {% endif %}
            </div>

            <div class="section-title">æœ€è¿‘ç·¨è¼¯çš„é¤é»</div>
            <div class="card-long recent-list">
                {% if recent_meals %}
                {% for meal in recent_meals %}
                <div class="recent-row">
                    <div class="recent-main">
                        <div class="recent-name">{{ meal.name }}</div>
                        <div class="recent-sub">
                            æœ€å¾Œç·¨è¼¯ï¼š{{ meal.updated_at|date:"n/d H:i" }} Â· åƒ¹æ ¼
                            {% if meal.price %}
                            ${{ meal.price|floatformat:0 }}
                            {% else %}
                            â€”
                            {% endif %}
                            Â· ç‹€æ…‹ï¼š
                            <span class="{% if meal.is_available %}on{% else %}off{% endif %}">
                                {{ meal.is_available|yesno:"ä¸Šæ¶ä¸­,å·²ä¸‹æ¶" }}
                            </span>
                        </div>
                    </div>
                    <a class="recent-btn" href="{% url 'merchantsideapp:edit_meal' meal.id %}">ç·¨è¼¯é¤é»</a>
                </div>
                {% endfor %}
                {% else %}
                <div class="recent-empty">ç›®å‰å°šç„¡é¤é»ç´€éŒ„ï¼Œå‰å¾€ã€Œæ–°å¢é¤é»ã€å³å¯å»ºç«‹ç¬¬ä¸€é“èœè‰²ã€‚</div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        window.merchantRoutes = {
            dashboard: "{% url 'merchantsideapp:dashboard' %}",
            addMeal: "{% url 'merchantsideapp:add_meal' %}",
            manageMeals: "{% url 'merchantsideapp:manage_meals' %}",
            settings: "{% url 'merchantsideapp:settings' %}",
            login: "{% url 'merchantsideapp:login' %}",
            logout: "{% url 'merchantsideapp:logout' %}"{% if restaurant %},
        restaurantDetail: "{% url 'merchantsideapp:restaurant_detail' restaurant.id %}"
        {% endif %}
        };
    </script>
    <script src="{% static 'merchantsideapp/js/merchant_homepage.js' %}"></script>
</body>

</html>