{% extends 'merchantsideapp/base_sidebar.html' %}
{% load static %}

{% block page_title %}Foodie Â· å•†å®¶ä¸»é {% endblock %}

{% block content %}
<!-- Welcome Hero -->
<div class="welcome-box mb-6">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
        <div>
            <h1 class="text-2xl font-bold text-gray-900 mb-1">æ­¡è¿å›ä¾†ï¼Œ{{ merchant_display_name }}ï¼</h1>
            <p class="text-gray-600">ä½ å¯ä»¥åœ¨é€™è£¡æ–°å¢é¤é»ã€ç·¨è¼¯æˆ–ä¸‹æ¶æ—¢æœ‰é¤é»ï¼Œæ–¹ä¾¿ç®¡ç†èœå–®ã€‚</p>
        </div>
        <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
            <span class="pill-{{ restaurant.is_active|yesno:'success,danger' }}">
                ç›®å‰ç‹€æ…‹ï¼š{% if restaurant and restaurant.is_active %}ç‡Ÿæ¥­{% else %}æ²’æœ‰ç‡Ÿæ¥­{% endif %}
            </span>
            {% if restaurant %}
            <form method="post" action="{% url 'merchantsideapp:restaurant_status' %}"
                class="flex items-center gap-3 text-sm">
                {% csrf_token %}
                <label class="text-gray-600" for="status-select">å¿«é€Ÿèª¿æ•´</label>
                <select id="status-select" name="status" class="form-input py-2">
                    <option value="open" {% if status_slug == 'open' %}selected{% endif %}>ç‡Ÿæ¥­</option>
                    <option value="closed" {% if status_slug == 'closed' %}selected{% endif %}>æ²’æœ‰ç‡Ÿæ¥­</option>
                </select>
                <button type="submit" class="btn-primary px-4 py-2 text-sm">æ›´æ–°</button>
            </form>
            {% endif %}
        </div>
    </div>
    <div class="mt-4 flex flex-wrap gap-6 text-sm text-gray-500">
        <span>ä»Šå¤©å·²å»ºç«‹é¤é»ï¼š<strong class="text-gray-900">{{ today_count }}</strong> ç­†</span>
        <span>æœ€å¾Œæ›´æ–°æ™‚é–“ï¼š
            {% if last_updated_meal %}
            <strong class="text-gray-900">{{ last_updated_meal.updated_at|date:"n/d H:i" }}</strong>
            {% else %}
            --
            {% endif %}
        </span>
    </div>
</div>

<!-- Ops Summary -->
<h2 class="text-lg font-semibold text-gray-900 mb-4">ç‡Ÿé‹æ¦‚æ³</h2>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
    <div class="card text-center">
        <div class="text-sm text-gray-500 mb-1">é¤å»³ç‹€æ…‹</div>
        <div class="text-2xl font-bold text-primary-600">
            {% if restaurant %}
            {{ restaurant.is_active|yesno:"ç‡Ÿæ¥­ä¸­,æš«åœç‡Ÿæ¥­" }}
            {% else %}
            å°šæœªå»ºç«‹é¤å»³
            {% endif %}
        </div>
        <p class="text-xs text-gray-400 mt-1">å¯éš¨æ™‚åœ¨æ­¤æ›´æ–°ç‡Ÿæ¥­ç‹€æ…‹</p>
    </div>
    <div class="card text-center">
        <div class="text-sm text-gray-500 mb-1">ä»Šæ—¥æ–°å¢é¤é»</div>
        <div class="text-2xl font-bold text-primary-600">{{ today_count }} é“</div>
        <p class="text-xs text-gray-400 mt-1">æ¯æ—¥ 00:00 é‡æ–°è¨ˆç®—</p>
    </div>
    <div class="card text-center">
        <div class="text-sm text-gray-500 mb-1">æœ€å¾Œç·¨è¼¯æ™‚é–“</div>
        <div class="text-xl font-bold text-primary-600">
            {% if last_updated_meal %}
            {{ last_updated_meal.updated_at|date:"n/d H:i" }}
            {% else %}
            å°šæœªå»ºç«‹é¤é»
            {% endif %}
        </div>
        <p class="text-xs text-gray-400 mt-1">æŒæ¡èœå–®æœ€æ–°å‹•æ…‹</p>
    </div>
</div>

<!-- Quick Actions -->
<h2 class="text-lg font-semibold text-gray-900 mb-4">å¿«é€Ÿæ“ä½œ</h2>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
    <div class="card text-center">
        <div class="text-4xl mb-3">â•</div>
        <h3 class="font-semibold text-gray-900 mb-2">æ–°å¢é¤é»</h3>
        <p class="text-sm text-gray-500 mb-4">å»ºç«‹æ–°çš„é¤é»å“é …ï¼ŒåŒ…å«åç¨±ã€åˆ†é¡ã€åƒ¹æ ¼ã€æè¿°èˆ‡ä¸Šå‚³ç…§ç‰‡ã€‚</p>
        <a class="btn-primary btn-block" id="btn-go-add" href="{% url 'merchantsideapp:add_meal' %}">å‰å¾€æ–°å¢é¤é»</a>
    </div>
    <div class="card text-center">
        <div class="text-4xl mb-3">ğŸ“‹</div>
        <h3 class="font-semibold text-gray-900 mb-2">ç®¡ç†é¤é»</h3>
        <p class="text-sm text-gray-500 mb-4">ç·¨è¼¯å·²å»ºç«‹çš„é¤é»ï¼Œå¯èª¿æ•´åƒ¹æ ¼ã€ä¿®æ”¹å…§å®¹ï¼Œæˆ–å°‡é¤é»ä¸Šæ¶ / ä¸‹æ¶ã€‚</p>
        <a class="btn-secondary btn-block" id="btn-go-manage" href="{% url 'merchantsideapp:manage_meals' %}">å‰å¾€ç®¡ç†é¤é»</a>
    </div>
    {% if restaurant %}
    <div class="card text-center">
        <div class="text-4xl mb-3">ğŸ¨</div>
        <h3 class="font-semibold text-gray-900 mb-2">é¤å»³è³‡è¨Š</h3>
        <p class="text-sm text-gray-500 mb-4">å¿«é€ŸæŸ¥çœ‹é¤å»³è©³ç´°è³‡è¨Šã€ä½ç½®èˆ‡ç›®å‰èœå–®ï¼Œä»¥ä¾¿åˆ†äº«çµ¦æ¶ˆè²»è€…ã€‚</p>
        <a class="btn-outline btn-block" id="btn-go-restaurant"
            href="{% url 'merchantsideapp:restaurant_detail' restaurant.id %}">æŸ¥çœ‹é¤å»³é é¢</a>
    </div>
    {% endif %}
</div>

<!-- Recent Meals -->
<h2 class="text-lg font-semibold text-gray-900 mb-4">æœ€è¿‘ç·¨è¼¯çš„é¤é»</h2>
<div class="card">
    {% if recent_meals %}
    <div class="divide-y divide-gray-100">
        {% for meal in recent_meals %}
        <div class="flex flex-col sm:flex-row sm:items-center justify-between py-4 gap-3">
            <div>
                <div class="font-medium text-gray-900">{{ meal.name }}</div>
                <div class="text-sm text-gray-500 space-x-2">
                    <span>æœ€å¾Œç·¨è¼¯ï¼š{{ meal.updated_at|date:"n/d H:i" }}</span>
                    <span>åƒ¹æ ¼ {% if meal.price %}${{ meal.price|floatformat:0 }}{% else %}â€”{% endif %}</span>
                    <span>ç‹€æ…‹ï¼š<span class="pill-{{ meal.is_available|yesno:'success,gray' }} text-xs">
                            {{ meal.is_available|yesno:"ä¸Šæ¶ä¸­,å·²ä¸‹æ¶" }}</span></span>
                </div>
            </div>
            <a class="btn-secondary text-sm px-4 py-2" href="{% url 'merchantsideapp:edit_meal' meal.id %}">ç·¨è¼¯é¤é»</a>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center text-gray-500 py-8">
        ç›®å‰å°šç„¡é¤é»ç´€éŒ„ï¼Œå‰å¾€ã€Œæ–°å¢é¤é»ã€å³å¯å»ºç«‹ç¬¬ä¸€é“èœè‰²ã€‚
    </div>
    {% endif %}
</div>
{% endblock %}