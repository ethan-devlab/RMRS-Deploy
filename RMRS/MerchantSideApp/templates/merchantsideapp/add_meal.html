{% load static %}
<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foodie Â· {{ page_title|default:"æ–°å¢é¤é»" }}</title>
    <link rel="stylesheet" href="{% static 'merchantsideapp/css/merchant_add_meal.css' %}">
</head>

<body>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="toggle-btn" id="toggleBtn">â˜°</button>
            <h2 class="logo"><span class="logo-text">Foodie å•†å®¶ç«¯</span></h2>
        </div>
        <ul>
            <li id="menu-dashboard">
                <span class="icon">ğŸ </span>
                <span class="item-text">ä¸»é ç¸½è¦½</span>
            </li>
            <li class="active" id="menu-add">
                <span class="icon">â•</span>
                <span class="item-text">æ–°å¢é¤é»</span>
            </li>
            <li id="menu-manage">
                <span class="icon">ğŸ“‹</span>
                <span class="item-text">ç®¡ç†é¤é»</span>
            </li>
            <li id="menu-settings">
                <span class="icon">âš™ï¸</span>
                <span class="item-text">è¨­å®š</span>
            </li>
            <li class="logout" id="menu-logout">
                <span class="icon">ğŸšª</span>
                <span class="item-text">ç™»å‡º</span>
            </li>
        </ul>
    </div>

    <div class="main">
        <div class="main-inner">
            {% if messages %}
                <ul class="messages">
                    {% for message in messages %}
                        <li class="{{ message.tags }}">{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            <div class="add-card">
                <div class="add-form-section">
                    <div class="add-title-row">
                        <div>
                            <p class="add-subtitle">{{ page_title|default:"æ–°å¢é¤é»" }}</p>
                            {% if is_edit and meal %}
                                <h2 class="add-title">æ­£åœ¨ç·¨è¼¯ï¼š{{ meal.name }}</h2>
                            {% else %}
                                <h2 class="add-title">é¤é»åŸºæœ¬è³‡æ–™</h2>
                            {% endif %}
                        </div>
                        {% if is_edit %}
                            <a class="add-btn ghost" href="{% url 'merchantsideapp:add_meal' %}">ï¼‹ æ”¹ç‚ºæ–°å¢</a>
                        {% endif %}
                    </div>
                    <form method="post" class="add-form" novalidate>
                        {% csrf_token %}
                        {% if form.non_field_errors %}
                            <div class="form-errors">
                                {% for error in form.non_field_errors %}<p>{{ error }}</p>{% endfor %}
                            </div>
                        {% endif %}

                        <div class="field-row two-cols">
                            <div class="field-group">
                                <label class="field-label" for="{{ form.name.id_for_label }}">å“é …åç¨± <span class="req">*</span></label>
                                {{ form.name }}
                                {% if form.name.errors %}
                                    <div class="field-errors">{% for error in form.name.errors %}<p>{{ error }}</p>{% endfor %}</div>
                                {% endif %}
                            </div>
                            <div class="field-group">
                                <label class="field-label" for="{{ form.category.id_for_label }}">å“é …é¡åˆ¥ <span class="req">*</span></label>
                                {{ form.category }}
                                {% if form.category.errors %}
                                    <div class="field-errors">{% for error in form.category.errors %}<p>{{ error }}</p>{% endfor %}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="field-group">
                            <label class="field-label" for="{{ form.description.id_for_label }}">å“é …æ•˜è¿°</label>
                            {{ form.description }}
                            {% if form.description.errors %}
                                <div class="field-errors">{% for error in form.description.errors %}<p>{{ error }}</p>{% endfor %}</div>
                            {% endif %}
                        </div>

                        <div class="field-row two-cols">
                            <div class="field-group short">
                                <label class="field-label" for="{{ form.price.id_for_label }}">åƒ¹æ ¼ï¼ˆå…ƒï¼‰ <span class="req">*</span></label>
                                {{ form.price }}
                                {% if form.price.errors %}
                                    <div class="field-errors">{% for error in form.price.errors %}<p>{{ error }}</p>{% endfor %}</div>
                                {% endif %}
                            </div>
                            <div class="field-group">
                                <label class="field-label" for="{{ form.image_url.id_for_label }}">é¤é»ç…§ç‰‡ï¼ˆURLï¼‰</label>
                                {{ form.image_url }}
                                {% if form.image_url.errors %}
                                    <div class="field-errors">{% for error in form.image_url.errors %}<p>{{ error }}</p>{% endfor %}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="toggle-row">
                            <label class="toggle-label">
                                {{ form.is_vegetarian }}
                                <span>æä¾›ç´ é£Ÿé¸é …</span>
                            </label>
                            <label class="toggle-label">
                                {{ form.is_spicy }}
                                <span>å«è¾›é¦™/è¾£å‘³</span>
                            </label>
                        </div>
                        {% if form.is_vegetarian.errors %}
                            <div class="field-errors">{% for error in form.is_vegetarian.errors %}<p>{{ error }}</p>{% endfor %}</div>
                        {% endif %}
                        {% if form.is_spicy.errors %}
                            <div class="field-errors">{% for error in form.is_spicy.errors %}<p>{{ error }}</p>{% endfor %}</div>
                        {% endif %}

                        <input type="file" id="meal-photo" accept="image/*" style="display:none;">

                        <div class="nutrition-section">
                            <div class="nutrition-header">
                                <h3>é¤é»ç‡Ÿé¤Šæˆåˆ†</h3>
                                <p class="nutrition-hint">æ–°å¢æ¯ä»½ç‡Ÿé¤Šæ•¸å€¼ï¼Œå°‡æœƒå„²å­˜åœ¨ meal_components.metadata æ¬„ä½ä¸­ã€‚</p>
                                <div class="nutrition-tags">
                                    <span class="nutrition-chip">æ¯ 1 ä»½</span>
                                    <span class="nutrition-chip subtle">ä»¥æ¨™æº– 100g/100ml è¨ˆ</span>
                                </div>
                            </div>
                            <div class="nutrition-panel">
                                <div class="nutrition-card form-card">
                                    <div class="nutrition-form">
                                        <div class="nutrition-field">
                                            <label class="nutrition-label" for="nutrition-name">æˆåˆ†åç¨±</label>
                                            <input type="text" id="nutrition-name" placeholder="å¦‚ï¼šè›‹ç™½è³ª">
                                        </div>
                                        <div class="nutrition-field">
                                            <label class="nutrition-label" for="nutrition-quantity">ä»½é‡ / å–®ä½</label>
                                            <input type="text" id="nutrition-quantity" placeholder="1 ä»½ / 250 ml">
                                        </div>
                                        <div class="nutrition-field">
                                            <label class="nutrition-label" for="nutrition-calories">ç†±é‡ (kcal)</label>
                                            <input type="number" step="0.1" min="0" id="nutrition-calories" placeholder="0">
                                        </div>
                                        <div class="nutrition-field">
                                            <label class="nutrition-label" for="nutrition-protein">è›‹ç™½è³ª (g)</label>
                                            <input type="number" step="0.1" min="0" id="nutrition-protein" placeholder="0">
                                        </div>
                                        <div class="nutrition-field">
                                            <label class="nutrition-label" for="nutrition-carb">ç¢³æ°´ (g)</label>
                                            <input type="number" step="0.1" min="0" id="nutrition-carb" placeholder="0">
                                        </div>
                                        <div class="nutrition-field">
                                            <label class="nutrition-label" for="nutrition-fat">è„‚è‚ª (g)</label>
                                            <input type="number" step="0.1" min="0" id="nutrition-fat" placeholder="0">
                                        </div>
                                        <div class="nutrition-field full">
                                            <label class="nutrition-label" for="nutrition-notes">å‚™è¨» (é¸å¡«)</label>
                                            <input type="text" id="nutrition-notes" placeholder="ä¾‹å¦‚ï¼šå«å …æœã€å­•å©¦æ…ç”¨ç­‰è²¼å¿ƒæé†’">
                                        </div>
                                        <div class="nutrition-actions">
                                            <div class="nutrition-meta">è¼¸å…¥å®Œæˆå¾Œé»é¸ä¸‹æ–¹æŒ‰éˆ•ï¼Œå°‡æˆåˆ†åŠ å…¥æœ¬æ¬¡é¤é»ã€‚</div>
                                            <div class="nutrition-action-buttons">
                                                <button type="button" class="add-btn secondary" id="nutrition-add-btn">åŠ å…¥ç‡Ÿé¤Šæˆåˆ†</button>
                                                <button type="button" class="add-btn ghost" id="nutrition-cancel-btn" hidden>å–æ¶ˆç·¨è¼¯</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="nutrition-card preview-card">
                                    <div class="nutrition-preview-header">
                                        <div>
                                            <p class="preview-title">æœ¬æ¬¡æ–°å¢æˆåˆ†</p>
                                            <p class="preview-sub">å·²åŠ å…¥ <span id="nutrition-count">0</span> é …ï¼ŒæŒ‰ä½å¯æ‹–æ›³é‡æ–°æ’åºï¼ˆå³å°‡æ¨å‡ºï¼‰ã€‚</p>
                                        </div>
                                        <span class="preview-chip">ç‡Ÿé¤Šè³‡è¨Šé è¦½</span>
                                    </div>
                                    <div class="nutrition-error" id="nutrition-error"></div>
                                    <div class="nutrition-list" id="nutrition-list"></div>
                                </div>
                            </div>
                            {{ form.nutrition_payload }}
                            {% if form.nutrition_payload.errors %}
                                <div class="field-errors">{% for error in form.nutrition_payload.errors %}<p>{{ error }}</p>{% endfor %}</div>
                            {% endif %}
                        </div>

                        <div class="add-actions">
                            <button type="submit" class="add-btn primary">{% if is_edit %}å„²å­˜è®Šæ›´{% else %}å„²å­˜é¤é»{% endif %}</button>
                            <button type="reset" class="add-btn ghost">æ¸…é™¤å…§å®¹</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.merchantRoutes = {
            dashboard: "{% url 'merchantsideapp:dashboard' %}",
            addMeal: "{% url 'merchantsideapp:add_meal' %}",
            manageMeals: "{% url 'merchantsideapp:manage_meals' %}",
            settings: "{% url 'merchantsideapp:settings' %}",
            login: "{% url 'merchantsideapp:login' %}",
            logout: "{% url 'merchantsideapp:logout' %}"
        };
    </script>
    <script src="{% static 'merchantsideapp/js/merchant_homepage.js' %}"></script>
    <script src="{% static 'merchantsideapp/js/merchant_add_meal.js' %}"></script>
</body>

</html>