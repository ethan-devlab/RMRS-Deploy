{% load static %}
<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foodie · 餐點資訊</title>
    <link rel="stylesheet" href="{% static 'shared/css/output.css' %}">
</head>

<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen">
    <div class="max-w-4xl mx-auto px-4 py-8">
        <div class="card">
            <!-- Header -->
            <div
                class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4 pb-6 border-b border-slate-200">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800">{{ meal.name|default:"未命名餐點" }}</h1>
                    <div class="flex flex-wrap gap-3 text-sm text-slate-500 mt-2">
                        <span>餐廳：{{ restaurant.name|default:"未指定餐廳" }}</span>
                        <span>建立時間：{{ meal.created_at|date:"Y/m/d H:i"|default:"--" }}</span>
                        <span>最後更新：{{ meal.updated_at|date:"Y/m/d H:i"|default:"--" }}</span>
                    </div>
                </div>
                <span
                    class="px-4 py-2 rounded-full text-sm font-medium {% if meal.is_available %}bg-emerald-100 text-emerald-700{% else %}bg-slate-200 text-slate-600{% endif %}">
                    {% if meal.is_available %}上架中{% else %}已下架{% endif %}
                </span>
            </div>

            <!-- Image -->
            <div class="py-6 border-b border-slate-200">
                {% if image_source %}
                <img src="{{ image_source }}" alt="{{ meal.name }} 圖片" class="w-full max-h-80 object-cover rounded-xl">
                {% else %}
                <div class="w-full h-48 bg-slate-100 rounded-xl flex items-center justify-center text-slate-400">
                    尚未上傳餐點照片</div>
                {% endif %}
            </div>

            <!-- Quick Info Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 py-6 border-b border-slate-200">
                <div class="text-center p-4 bg-slate-50 rounded-xl">
                    <div class="text-xs text-slate-500 uppercase tracking-wider">售價</div>
                    <div class="text-xl font-bold text-slate-800 mt-1">
                        {% if meal.price %}${{ meal.price|floatformat:0 }}{% else %}--{% endif %}
                    </div>
                </div>
                <div class="text-center p-4 bg-slate-50 rounded-xl">
                    <div class="text-xs text-slate-500 uppercase tracking-wider">餐點分類</div>
                    <div class="text-xl font-bold text-slate-800 mt-1">{{ meal.category|default:"未設定" }}</div>
                </div>
                <div class="text-center p-4 bg-slate-50 rounded-xl">
                    <div class="text-xs text-slate-500 uppercase tracking-wider">熱量 (kcal)</div>
                    <div class="text-xl font-bold text-slate-800 mt-1">
                        {% if nutrition and nutrition.calories %}{{ nutrition.calories|floatformat:0 }}{% else %}--{% endif %}
                    </div>
                </div>
                <div class="text-center p-4 bg-slate-50 rounded-xl">
                    <div class="text-xs text-slate-500 uppercase tracking-wider">庫存狀態</div>
                    <div class="text-xl font-bold text-slate-800 mt-1">{{ meal.stock_status|default:"--" }}</div>
                </div>
            </div>

            <!-- Description -->
            <div class="py-6 border-b border-slate-200">
                <h3 class="font-bold text-slate-800 mb-3">餐點說明</h3>
                <p class="text-slate-600 leading-relaxed">{{ meal.description|default:"尚未填寫餐點描述"|linebreaksbr }}</p>
            </div>

            <!-- Nutrition Info -->
            <div class="py-6 border-b border-slate-200">
                <h3 class="font-bold text-slate-800 mb-3">營養資訊</h3>
                {% if nutrition %}
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-slate-200">
                            <th class="text-left py-2 text-slate-500 font-medium">項目</th>
                            <th class="text-right py-2 text-slate-500 font-medium">數值</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b border-slate-100">
                            <td class="py-2 text-slate-700">蛋白質</td>
                            <td class="py-2 text-right text-slate-800 font-medium">{{ nutrition.protein|default:"--" }}
                                g</td>
                        </tr>
                        <tr class="border-b border-slate-100">
                            <td class="py-2 text-slate-700">脂肪</td>
                            <td class="py-2 text-right text-slate-800 font-medium">{{ nutrition.fat|default:"--" }} g
                            </td>
                        </tr>
                        <tr class="border-b border-slate-100">
                            <td class="py-2 text-slate-700">碳水化合物</td>
                            <td class="py-2 text-right text-slate-800 font-medium">{{ nutrition.carbs|default:"--" }} g
                            </td>
                        </tr>
                        <tr class="border-b border-slate-100">
                            <td class="py-2 text-slate-700">鈉</td>
                            <td class="py-2 text-right text-slate-800 font-medium">{{ nutrition.sodium|default:"--" }}
                                mg</td>
                        </tr>
                        <tr>
                            <td class="py-2 text-slate-700">纖維</td>
                            <td class="py-2 text-right text-slate-800 font-medium">{{ nutrition.fiber|default:"--" }} g
                            </td>
                        </tr>
                    </tbody>
                </table>
                {% else %}
                <p class="text-slate-500">尚未登錄營養資訊。</p>
                {% endif %}
            </div>

            <!-- Ingredients -->
            <div class="py-6 border-b border-slate-200">
                <h3 class="font-bold text-slate-800 mb-3">主要食材</h3>
                {% if ingredients %}
                <div class="flex flex-wrap gap-2">
                    {% for ingredient in ingredients %}
                    <span class="px-3 py-1 bg-slate-100 text-slate-700 rounded-full text-sm">{{ ingredient }}</span>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-slate-500">尚未提供食材列表。</p>
                {% endif %}
            </div>

            <!-- Allergens -->
            <div class="py-6 border-b border-slate-200">
                <h3 class="font-bold text-slate-800 mb-3">過敏原提醒</h3>
                {% if allergens %}
                <div class="flex flex-wrap gap-2">
                    {% for item in allergens %}
                    <span class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-medium">{{ item }}</span>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-slate-500">未標示特別過敏原。</p>
                {% endif %}
            </div>

            <!-- Actions -->
            <div class="flex flex-wrap items-center justify-between gap-4 pt-6">
                <a href="{% url 'merchantsideapp:restaurant_detail' restaurant.id %}"
                    class="text-primary hover:text-primary-dark hover:underline font-medium">
                    ← 返回 {{ restaurant.name|default:"餐廳" }} 菜單
                </a>
                {% if can_edit %}
                <form action="{% url 'merchantsideapp:edit_meal' meal.id %}" method="get">
                    <button type="submit" class="btn-primary">編輯餐點</button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
</body>

</html>