{% extends 'usersideapp/base_sidebar.html' %}
{% load static %}
{% block page_title %}Foodie Â· é¦–é {% endblock %}

{% block content %}
<!-- Welcome Hero -->
<div class="welcome-box mb-6">
    <div class="flex flex-col xl:flex-row xl:items-center gap-6">
        <div class="flex-1 space-y-4">
            <div class="space-y-2">
                <p class="text-lg font-semibold tracking-widest text-gray-500 uppercase">ä»Šæ—¥ç‡Ÿé¤Šæ‘˜è¦</p>
                <div class="flex flex-col lg:flex-row lg:items-end gap-3">
                    <h1 class="text-2xl font-bold text-gray-900">å“ˆå›‰ï¼Œ
                        {{ current_user.full_name|default:current_user.username }}</h1>
                    <span
                        class="inline-flex items-center gap-2 text-sm font-semibold text-primary-700 bg-primary-50 border border-primary-100 rounded-full px-3 py-1">
                        ğŸ”¥ ä»Šæ—¥å·²æ”å– {{ today_stats.total_calories|floatformat:0 }} kcal
                    </span>
                </div>
                <p class="text-gray-600">æœ¬é€±å·²è¨˜éŒ„ <strong class="text-gray-900">{{ weekly_summary.meal_count|default:0 }}</strong> é¤ï¼Œç¶­æŒç¯€å¥è¶…æ£’ï¼æŒçºŒè¨˜éŒ„å³å¯ç²å¾—æ›´è°æ˜çš„æ¨è–¦ã€‚</p>
            </div>
            <div class="flex flex-wrap gap-3">
                <a href="{% url 'usersideapp:record' %}" class="btn-primary inline-flex items-center gap-2 px-4 py-2">ğŸ½ è¨˜éŒ„ä»Šæ—¥é£²é£Ÿ</a>
                <a href="{% url 'usersideapp:search' %}"
                    class="btn-secondary inline-flex items-center gap-2 px-4 py-2">ğŸ“ æ¢ç´¢é™„è¿‘é¤å»³</a>
                <a href="{% url 'usersideapp:random' %}"
                    class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-200 text-gray-700 hover:border-primary-200 hover:text-primary-700 transition">
                    ğŸ² éš¨æ©Ÿæ¨è–¦</a>
            </div>
        </div>

        <div class="flex-1 bg-white/80 rounded-xl p-4 shadow-sm border border-white/70">
            <div class="grid grid-cols-3 gap-4 text-center">
                <div class="space-y-1">
                    <span class="block text-xs text-gray-500 uppercase tracking-wide">è›‹ç™½è³ª</span>
                    <span class="block text-xl font-semibold text-gray-900">
                        {{ today_stats.total_protein|floatformat:1 }} g</span>
                    <span class="block text-xs text-gray-400">ä»Šæ—¥ç´¯ç©</span>
                </div>
                <div class="space-y-1">
                    <span class="block text-xs text-gray-500 uppercase tracking-wide">ç¢³æ°´</span>
                    <span class="block text-xl font-semibold text-gray-900">
                        {{ today_stats.total_carbs|floatformat:1 }} g</span>
                    <span class="block text-xs text-gray-400">ä»Šæ—¥ç´¯ç©</span>
                </div>
                <div class="space-y-1">
                    <span class="block text-xs text-gray-500 uppercase tracking-wide">è„‚è‚ª</span>
                    <span class="block text-xl font-semibold text-gray-900">
                        {{ today_stats.total_fat|floatformat:1 }} g</span>
                    <span class="block text-xs text-gray-400">ä»Šæ—¥ç´¯ç©</span>
                </div>
            </div>
            <div
                class="mt-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 border-t border-gray-200 pt-4">
                <div>
                    <p class="text-xs text-gray-500 uppercase tracking-wide">ä¸‹ä¸€æ¬¡æé†’</p>
                    <p class="text-sm font-semibold text-gray-900">
                        {% if next_reminder %}
                        {{ next_reminder.get_reminder_type_display }} Â· 
                        {{ next_reminder.scheduled_time|default:"æ™ºæ…§æ¨é€" }}
                        {% else %}
                        å°šæœªæ’ç¨‹
                        {% endif %}
                    </p>
                </div>
                <div class="text-sm text-gray-600">
                    {% if next_reminder %}
                    â° æ¨æ’­ç‹€æ…‹ï¼š{{ next_reminder.is_enabled|yesno:"é–‹å•Ÿ,é—œé–‰" }}
                    {% else %}
                    â° ä½¿ç”¨æé†’ç¶­æŒè¦å¾‹é£²é£Ÿ
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Today Summary -->
<h2 class="text-lg font-semibold text-gray-900 mb-4">ä»Šæ—¥æ¦‚æ³</h2>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
    <div class="card text-center">
        <div class="text-sm text-gray-500 mb-1">ç•¶æ—¥ç†±é‡</div>
        <div class="text-2xl font-bold text-primary-600">{{ today_stats.total_calories|floatformat:0 }} kcal</div>
        <p class="text-xs text-gray-400 mt-1">{{ today_date|date:"m/d" }}</p>
    </div>
    <div class="card text-center">
        <div class="text-sm text-gray-500 mb-1">æœ¬é€±å·²è¨˜éŒ„</div>
        <div class="text-2xl font-bold text-primary-600">{{ weekly_summary.meal_count|default:0 }} é¤</div>
        <p class="text-xs text-gray-400 mt-1">é€±èµ·ï¼š{{ weekly_summary.week_start|date:"m/d" }}</p>
    </div>
    <div class="card text-center">
        <div class="text-sm text-gray-500 mb-1">ä¸‹ä¸€æ¬¡æé†’</div>
        <div class="text-xl font-bold text-primary-600">
            {% if next_reminder %}
            {{ next_reminder.get_reminder_type_display }} Â· {{ next_reminder.scheduled_time|default:"æ™ºæ…§æ¨é€" }}
            {% else %}
            å°šæœªæ’ç¨‹
            {% endif %}
        </div>
        <p class="text-xs text-gray-400 mt-1">
            {% if next_reminder %}
            æ¨æ’­ç‹€æ…‹ï¼š{{ next_reminder.is_enabled|yesno:"é–‹å•Ÿ,é—œé–‰" }}
            {% else %}
            å°šæœªè¨­å®šæé†’
            {% endif %}
        </p>
    </div>
</div>

<!-- Recent Meals -->
<h2 class="text-lg font-semibold text-gray-900 mb-4">æœ€è¿‘çš„é£²é£Ÿç´€éŒ„</h2>
{% if recent_meals %}
<div class="space-y-3 mb-8">
    {% for meal in recent_meals %}
    <div class="card flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div>
            <div class="font-medium text-gray-900">{{ meal.date|date:"m/d" }} Â· {{ meal.get_meal_type_display }}</div>
            <div class="text-sm text-gray-500">{{ meal.meal_name }}</div>
        </div>
        <div class="flex gap-4 text-sm text-gray-600">
            <span>ğŸ½ {{ meal.calories }} kcal</span>
            <span>ğŸ¥š {{ meal.protein_grams }} g è›‹ç™½è³ª</span>
        </div>
        <a href="{% url 'usersideapp:record' %}" class="btn-secondary text-sm px-4 py-2">æŸ¥çœ‹</a>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card text-center text-gray-500 py-8 mb-8">
    ç›®å‰å°šæœªæœ‰é£²é£Ÿç´€éŒ„ï¼Œé»æ“Šã€Œä»Šæ—¥é£²é£Ÿã€é–‹å§‹ç´€éŒ„å§ï¼
</div>
{% endif %}

<!-- Notifications Overview -->
<h2 class="text-lg font-semibold text-gray-900 mb-4">æ¨æ’­æé†’èˆ‡é€šçŸ¥</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div class="card">
        <h3 class="font-semibold text-gray-900 mb-3">æé†’è¨­å®š</h3>
        <ul class="space-y-2">
            {% for setting in notification_settings %}
            <li class="flex items-center justify-between py-2 border-b border-gray-100 last:border-0">
                <span class="text-gray-700">{{ setting.get_reminder_type_display }}</span>
                <span class="pill-{{ setting.is_enabled|yesno:'success,gray' }}">
                    {% if setting.is_enabled %}
                    {{ setting.scheduled_time|default:"æ™ºæ…§æ¨é€" }}
                    {% else %}
                    å·²é—œé–‰
                    {% endif %}
                </span>
            </li>
            {% endfor %}
        </ul>
    </div>
    <div class="card">
        <h3 class="font-semibold text-gray-900 mb-3">æœ€æ–°é€šçŸ¥</h3>
        {% if latest_notifications %}
        <ul class="space-y-3">
            {% for item in latest_notifications %}
            <li class="flex items-start justify-between gap-3">
                <div>
                    <strong class="text-gray-900">{{ item.title }}</strong>
                    <p class="text-sm text-gray-500">{{ item.body }}</p>
                </div>
                <span class="text-xs text-gray-400 whitespace-nowrap">{{ item.sent_at|date:"m/d H:i" }}</span>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="text-gray-500 text-center py-4">å°šæœªæ”¶åˆ°é€šçŸ¥</p>
        {% endif %}
    </div>
</div>
{% endblock %}