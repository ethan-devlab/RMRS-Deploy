{% extends 'usersideapp/base_sidebar.html' %}
{% block page_title %}Foodie Â· é¦–é {% endblock %}
{% block content %}
<div class="welcome-box home-hero">
    <div>
        <h1>å“ˆå›‰ï¼Œ{{ current_user.full_name|default:current_user.username }}</h1>
        <p>ä»Šå¤©ç›®å‰ç´¯ç© <strong>{{ today_stats.total_calories|floatformat:0 }}</strong> kcalï¼ŒæŒçºŒä¿æŒå¥½ç¿’æ…£ï¼</p>
    </div>
    <div class="hero-stats">
        <div class="hero-stat">
            <span class="label">è›‹ç™½è³ª</span>
            <span class="value">{{ today_stats.total_protein|floatformat:1 }} g</span>
        </div>
        <div class="hero-stat">
            <span class="label">ç¢³æ°´</span>
            <span class="value">{{ today_stats.total_carbs|floatformat:1 }} g</span>
        </div>
        <div class="hero-stat">
            <span class="label">è„‚è‚ª</span>
            <span class="value">{{ today_stats.total_fat|floatformat:1 }} g</span>
        </div>
    </div>
</div>

<div class="section-title">ä»Šæ—¥æ¦‚æ³</div>
<div class="card-row home-summary">
    <div class="card mini-card">
        <div class="mini-title">ç•¶æ—¥ç†±é‡</div>
        <div class="mini-value">{{ today_stats.total_calories|floatformat:0 }} kcal</div>
        <p class="mini-note">{{ today_date|date:"m/d" }}</p>
    </div>
    <div class="card mini-card">
        <div class="mini-title">æœ¬é€±å·²è¨˜éŒ„</div>
        <div class="mini-value">{{ weekly_summary.meal_count|default:0 }} é¤</div>
        <p class="mini-note">é€±èµ·ï¼š{{ weekly_summary.week_start|date:"m/d" }}</p>
    </div>
    <div class="card mini-card">
        <div class="mini-title">ä¸‹ä¸€æ¬¡æé†’</div>
        <div class="mini-value">
            {% if next_reminder %}
            {{ next_reminder.get_reminder_type_display }} Â·
            {{ next_reminder.scheduled_time|default:"æ™ºæ…§æ¨é€" }}
            {% else %}
            å°šæœªæ’ç¨‹
            {% endif %}
        </div>
        <p class="mini-note">
            {% if next_reminder %}
            æ¨æ’­ç‹€æ…‹ï¼š{{ next_reminder.is_enabled|yesno:"é–‹å•Ÿ,é—œé–‰" }}
            {% else %}
            å°šæœªè¨­å®šæé†’
            {% endif %}
        </p>
    </div>
</div>

<div class="section-title">æœ€è¿‘çš„é£²é£Ÿç´€éŒ„</div>
{% if recent_meals %}
<div class="record-list">
    {% for meal in recent_meals %}
    <div class="card-long record-item">
        <div class="record-row">
            <div>
                <div class="record-date-main">{{ meal.date|date:"m/d" }} Â· {{ meal.get_meal_type_display }}</div>
                <div class="record-date-sub">{{ meal.meal_name }}</div>
            </div>
            <div class="record-summary">
                <div>ğŸ½ {{ meal.calories }} kcal</div>
                <div>ğŸ¥š {{ meal.protein_grams }} g è›‹ç™½è³ª</div>
            </div>
            <div class="record-actions">
                <a href="{% url 'usersideapp:record' %}" class="link-btn">æŸ¥çœ‹</a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card-long empty-state">
    ç›®å‰å°šæœªæœ‰é£²é£Ÿç´€éŒ„ï¼Œé»æ“Šã€Œä»Šæ—¥é£²é£Ÿã€é–‹å§‹ç´€éŒ„å§ï¼
</div>
{% endif %}

<div class="section-title">æ¨æ’­æé†’èˆ‡é€šçŸ¥</div>
<div class="card-row notify-overview">
    <div class="card">
        <h3>æé†’è¨­å®š</h3>
        <ul class="notify-mini-list">
            {% for setting in notification_settings %}
            <li>
                <span>{{ setting.get_reminder_type_display }}</span>
                <span class="pill {{ setting.is_enabled|yesno:'on,off' }}">
                    {% if setting.is_enabled %}
                    {{ setting.scheduled_time|default:"æ™ºæ…§æ¨é€" }}
                    {% else %}
                    å·²é—œé–‰
                    {% endif %}
                </span>
            </li>
            {% endfor %}
        </ul>
    </div>
    <div class="card">
        <h3>æœ€æ–°é€šçŸ¥</h3>
        {% if latest_notifications %}
        <ul class="notify-mini-list">
            {% for item in latest_notifications %}
            <li>
                <div>
                    <strong>{{ item.title }}</strong>
                    <p>{{ item.body }}</p>
                </div>
                <span class="time">{{ item.sent_at|date:"m/d H:i" }}</span>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="empty-note">å°šæœªæ”¶åˆ°é€šçŸ¥</p>
        {% endif %}
    </div>
</div>
{% endblock %}