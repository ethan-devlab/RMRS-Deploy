{% extends 'usersideapp/base_sidebar.html' %}
{% block page_title %}ä»Šæ—¥é£²é£Ÿ{% endblock %}
{% block content %}
<div class="welcome-box today-header">
    <div class="today-left">
        <h1>ä»Šæ—¥é£²é£Ÿ</h1>
        <p>ğŸ“… {{ today_date|date:"Y-m-d" }} Â· ç´¯ç© {{ today_stats.total_calories|floatformat:0 }} kcal</p>
    </div>
    <div class="today-right">
        <div class="today-summary">
            <span>è›‹ç™½è³ªï¼š<strong>{{ today_stats.total_protein|floatformat:1 }} g</strong></span>
            <span>ç¢³æ°´ï¼š<strong>{{ today_stats.total_carbs|floatformat:1 }} g</strong></span>
            <span>è„‚è‚ªï¼š<strong>{{ today_stats.total_fat|floatformat:1 }} g</strong></span>
        </div>
        <a class="outline-btn" href="{% url 'usersideapp:record' %}">ï¼‹ æ–°å¢é£²é£Ÿç´€éŒ„</a>
    </div>
</div>

<div class="section-title">ä»Šæ—¥æ¦‚æ³</div>
<div class="card-row today-stats-row">
    {% for block in meal_blocks %}
    <div class="card mini-card">
        <div class="mini-title">{{ block.label }}</div>
        {% if block.record %}
        <div class="mini-value">{{ block.record.calories }} kcal</div>
        <div class="mini-note">{{ block.record.meal_name }}</div>
        {% else %}
        <div class="mini-value">â€”</div>
        <div class="mini-note">å°šæœªè¨˜éŒ„</div>
        {% endif %}
    </div>
    {% endfor %}
</div>

<div class="section-title">é¤æ¬¡è©³ç´°</div>
<div class="meal-grid">
    {% for block in meal_blocks %}
    <div class="card meal-card">
        <div class="meal-header">
            <span class="meal-tag {{ block.value }}">{{ block.label }}</span>
            <span class="meal-kcal">{% if block.record %}{{ block.record.calories }} kcal{% else %}â€”{% endif %}</span>
        </div>
        {% if block.record %}
        <div class="meal-detail">
            <p class="meal-title">{{ block.record.meal_name }}</p>
            <p class="meal-macros">è›‹ç™½è³ª {{ block.record.protein_grams }} g Â· ç¢³æ°´ {{ block.record.carb_grams }} g Â· è„‚è‚ª {{
                block.record.fat_grams }} g</p>
            {% with component_list=block.record.components.all %}
            {% if component_list %}
            <ul class="component-list">
                {% for component in component_list %}
                <li>
                    <strong>{{ component.name }}</strong>
                    <span>{{ component.quantity|default:"" }}</span>
                    <span>{{ component.calories }} kcal</span>
                </li>
                {% endfor %}
            </ul>
            {% endif %}
            {% endwith %}
            {% if block.record.ingredients %}
            <p class="meal-ingredients">é£Ÿæï¼š{{ block.record.ingredients|join:", " }}</p>
            {% endif %}
            {% if block.record.meal_notes %}
            <p class="meal-notes">å‚™è¨»ï¼š{{ block.record.meal_notes }}</p>
            {% endif %}
        </div>
        {% else %}
        <p class="meal-empty">é‚„æ²’æœ‰æ–°å¢{{ block.label }}ç´€éŒ„</p>
        <a class="meal-add-btn" href="{% url 'usersideapp:record' %}">ï¼‹ è¨˜éŒ„ {{ block.label }}</a>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endblock %}