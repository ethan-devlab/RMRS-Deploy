{% extends 'usersideapp/base_sidebar.html' %}
{% load static %}
{% block page_title %}ä»Šæ—¥é£²é£Ÿ{% endblock %}

{% block content %}
<!-- Header -->
<div class="welcome-box mb-6">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
            <h1 class="text-2xl font-bold text-gray-900 mb-1">ä»Šæ—¥é£²é£Ÿ</h1>
            <p class="text-gray-600">ğŸ“… {{ today_date|date:"Y-m-d" }} Â· ç´¯ç© <strong class="text-primary-600">
                {{ today_stats.total_calories|floatformat:0 }}</strong> kcal</p>
        </div>
        <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
            <div class="flex gap-4 text-sm">
                <span class="text-gray-600">è›‹ç™½è³ªï¼š<strong class="text-gray-900">
                    {{ today_stats.total_protein|floatformat:1 }} g</strong></span>
                <span class="text-gray-600">ç¢³æ°´ï¼š<strong class="text-gray-900">
                    {{ today_stats.total_carbs|floatformat:1 }} g</strong></span>
                <span class="text-gray-600">è„‚è‚ªï¼š<strong class="text-gray-900">
                    {{ today_stats.total_fat|floatformat:1 }} g</strong></span>
            </div>
            <a class="btn-secondary text-sm px-4 py-2" href="{% url 'usersideapp:record' %}">ï¼‹ æ–°å¢é£²é£Ÿç´€éŒ„</a>
        </div>
    </div>
</div>

<!-- Summary Stats -->
<h2 class="text-lg font-semibold text-gray-900 mb-4">ä»Šæ—¥æ¦‚æ³</h2>
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
    {% for block in meal_blocks %}
    <div class="card text-center">
        <div class="text-sm text-gray-500 mb-1">{{ block.label }}</div>
        {% if block.record %}
        <div class="text-xl font-bold text-primary-600">{{ block.record.calories }} kcal</div>
        <div class="text-xs text-gray-400 mt-1">{{ block.record.meal_name }}</div>
        {% else %}
        <div class="text-xl font-bold text-gray-300">â€”</div>
        <div class="text-xs text-gray-400 mt-1">å°šæœªè¨˜éŒ„</div>
        {% endif %}
    </div>
    {% endfor %}
</div>

<!-- Meal Details -->
<h2 class="text-lg font-semibold text-gray-900 mb-4">é¤æ¬¡è©³ç´°</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    {% for block in meal_blocks %}
    <div class="card">
        <div class="flex items-center justify-between mb-3">
            <span
                class="pill-{% if block.value == 'breakfast' %}info{% elif block.value == 'lunch' %}warning{% elif block.value == 'dinner' %}success{% else %}neutral{% endif %}">
                {{ block.label }}</span>
            <span class="text-sm font-semibold text-gray-700">
                {% if block.record %}{{ block.record.calories }} kcal{% else %}â€”{% endif %}</span>
        </div>
        {% if block.record %}
        <div class="space-y-2">
            <p class="font-medium text-gray-900">{{ block.record.meal_name }}</p>
            <p class="text-sm text-gray-500">
                è›‹ç™½è³ª {{ block.record.protein_grams }} g Â· ç¢³æ°´ {{ block.record.carb_grams }} g
                Â· è„‚è‚ª {{ block.record.fat_grams }} g</p>
            {% with component_list=block.record.components.all %}
            {% if component_list %}
            <ul class="mt-3 space-y-1 text-sm">
                {% for component in component_list %}
                <li class="flex justify-between text-gray-600 py-1 border-b border-gray-100 last:border-0">
                    <span><strong>{{ component.name }}</strong> {{ component.quantity|default:"" }}</span>
                    <span>{{ component.calories }} kcal</span>
                </li>
                {% endfor %}
            </ul>
            {% endif %}
            {% endwith %}
            {% if block.record.ingredients %}
            <p class="text-sm text-gray-500">é£Ÿæï¼š{{ block.record.ingredients|join:", " }}</p>
            {% endif %}
            {% if block.record.meal_notes %}
            <p class="text-sm text-gray-400 italic">å‚™è¨»ï¼š{{ block.record.meal_notes }}</p>
            {% endif %}
        </div>
        {% else %}
        <p class="text-gray-400 text-center py-4">é‚„æ²’æœ‰æ–°å¢{{ block.label }}ç´€éŒ„</p>
        <a class="btn-primary btn-block text-sm" href="{% url 'usersideapp:record' %}">ï¼‹ è¨˜éŒ„ {{ block.label }}</a>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endblock %}